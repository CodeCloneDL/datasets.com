<html>
<head>
    <title>NiCad6 Clone Report</title>
    <style type="text/css">
        body {font-family:sans-serif;}
        table {background-color:white; border:0px; padding:0px; border-spacing:4px; width:auto; margin-left:30px; margin-right:auto;}
        td {background-color:rgba(192,212,238,0.8); border:0px; padding:8px; width:auto; vertical-align:top; border-radius:8px}
        pre {background-color:white; padding:4px;}
        a {color:darkblue;}
    </style>
</head>
<body>
<h2>NiCad6 Clone Report</h2>
<table>
<tr style="font-size:14pt">
<td><b>System:</b> &nbsp; eve-1.1.5</td>
<td><b>Clone pairs:</b> &nbsp; 15</td>
<td><b>Clone classes:</b> &nbsp; 13</td>
</tr>
<tr style="font-size:12pt">
<td style="background-color:white">Clone type: &nbsp; 2</td>
<td style="background-color:white">Granularity: &nbsp; functions-blind</td>
<td style="background-color:white">Max diff threshold: &nbsp; 0%</td>
<td style="background-color:white">Clone size: &nbsp; 10 - 2500 lines</td>
<td style="background-color:white">Total functions-blind: &nbsp; 1193</td>
</tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 1:</b> &nbsp; 2 fragments, nominal size 13 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag569')" href="javascript:;">
eve-1.1.5/eve/tests/methods/patch.py: 294-309
</a>
<div class="mid" id="frag569" style="display:none"><pre>
    def test_patch_internal(self):
        # test that patch_internal is available and working properly.
        test_field = "ref"
        test_value = "9876543210987654321098765"
        data = {test_field: test_value}
        with self.app.test_request_context(self.item_id_url):
            r, _, _, status = patch_internal(
                self.known_resource,
                data,
                concurrency_check=False,
                **{"_id": self.item_id}
            )
        db_value = self.compare_patch_with_get(test_field, r)
        self.assertEqual(db_value, test_value)
        self.assert200(status)

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag642')" href="javascript:;">
eve-1.1.5/eve/tests/methods/put.py: 440-455
</a>
<div class="mid" id="frag642" style="display:none"><pre>
    def test_put_internal(self):
        # test that put_internal is available and working properly.
        test_field = "ref"
        test_value = "9876543210987654321098765"
        data = {test_field: test_value}
        with self.app.test_request_context(self.item_id_url):
            r, _, _, status = put_internal(
                self.known_resource,
                data,
                concurrency_check=False,
                **{"_id": self.item_id}
            )
        db_value = self.compare_put_with_get(test_field, r)
        self.assertEqual(db_value, test_value)
        self.assert200(status)

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 2:</b> &nbsp; 2 fragments, nominal size 13 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag585')" href="javascript:;">
eve-1.1.5/eve/tests/methods/patch.py: 529-546
</a>
<div class="mid" id="frag585" style="display:none"><pre>
    def test_patch_bandwidth_saver(self):
        changes = {"ref": "1234567890123456789012345"}

        # bandwidth_saver is on by default
        self.assertTrue(self.app.config["BANDWIDTH_SAVER"])
        r = self.perform_patch(changes)
        self.assertFalse("ref" in r)
        db_value = self.compare_patch_with_get(self.app.config["ETAG"], r)
        self.assertEqual(db_value, r[self.app.config["ETAG"]])
        self.item_etag = r[self.app.config["ETAG"]]

        # test return all fields (bandwidth_saver off)
        self.app.config["BANDWIDTH_SAVER"] = False
        r = self.perform_patch(changes)
        self.assertTrue("ref" in r)
        db_value = self.compare_patch_with_get(self.app.config["ETAG"], r)
        self.assertEqual(db_value, r[self.app.config["ETAG"]])

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag637')" href="javascript:;">
eve-1.1.5/eve/tests/methods/put.py: 347-364
</a>
<div class="mid" id="frag637" style="display:none"><pre>
    def test_put_bandwidth_saver(self):
        changes = {"ref": "1234567890123456789012345"}

        # bandwidth_saver is on by default
        self.assertTrue(self.app.config["BANDWIDTH_SAVER"])
        r = self.perform_put(changes)
        self.assertFalse("ref" in r)
        db_value = self.compare_put_with_get(self.app.config["ETAG"], r)
        self.assertEqual(db_value, r[self.app.config["ETAG"]])
        self.item_etag = r[self.app.config["ETAG"]]

        # test return all fields (bandwidth_saver off)
        self.app.config["BANDWIDTH_SAVER"] = False
        r = self.perform_put(changes)
        self.assertTrue("ref" in r)
        db_value = self.compare_put_with_get(self.app.config["ETAG"], r)
        self.assertEqual(db_value, r[self.app.config["ETAG"]])

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 3:</b> &nbsp; 2 fragments, nominal size 39 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag586')" href="javascript:;">
eve-1.1.5/eve/tests/methods/patch.py: 547-589
</a>
<div class="mid" id="frag586" style="display:none"><pre>
    def test_patch_bandwidth_saver_credit_rule_broken(self):
        _db = self.connection[MONGO_DBNAME]
        rule = {
            "amount": 300.0,
            "duration": "months",
            "name": "Testing BANDWIDTH_SAVER=False",
            "start": "2020-03-28T06:00:00 UTC",
        }
        rule_id = _db.credit_rules.insert_one(rule).inserted_id
        rule_url = "credit_rules/%s/" % (rule_id)
        changes = {
            "amount": 120.0,
            "duration": "months",
            "start": "2020-04-01T00:00:00 UTC",
        }
        response, _ = self.get("credit_rules/%s/" % (rule_id))
        etag = response[ETAG]
        # bandwidth_saver is on by default
        self.assertTrue(self.app.config["BANDWIDTH_SAVER"])
        self.assertTrue(self.app.config["PROJECTION"])
        r, status = self.patch(rule_url, data=changes, headers=[("If-Match", etag)])
        self.assert200(status)
        self.assertPatchResponse(r, "%s" % (rule_id))
        self.assertFalse("amount" in r)
        etag = r[self.app.config["ETAG"]]
        r, _ = self.get(rule_url, "")
        self.assertEqual(etag, r[self.app.config["ETAG"]])

        # test return all fields (bandwidth_saver off)
        self.app.config["BANDWIDTH_SAVER"] = False
        changes["name"] = "Give it all to me!"
        r, status = self.patch(rule_url, data=changes, headers=[("If-Match", etag)])
        self.assert200(status)
        self.assertPatchResponse(r, "%s" % (rule_id))
        self.assertTrue(
            all(["amount" in r, "duration" in r, "name" in r, "start" in r]),
            'One or more of "amount", "duration", "name", "start" is missing.',
        )
        self.assertTrue(r["name"] == "Give it all to me!")
        etag = r[self.app.config["ETAG"]]
        r, status = self.get(rule_url, "")
        self.assertEqual(etag, r[self.app.config["ETAG"]])

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag638')" href="javascript:;">
eve-1.1.5/eve/tests/methods/put.py: 365-407
</a>
<div class="mid" id="frag638" style="display:none"><pre>
    def test_put_bandwidth_saver_credit_rule_broken(self):
        _db = self.connection[MONGO_DBNAME]
        rule = {
            "amount": 300.0,
            "duration": "months",
            "name": "Testing BANDWIDTH_SAVER=False",
            "start": "2020-03-28T06:00:00 UTC",
        }
        rule_id = _db.credit_rules.insert_one(rule).inserted_id
        rule_url = "credit_rules/%s/" % (rule_id)
        changes = {
            "amount": 120.0,
            "duration": "months",
            "start": "2020-04-01T00:00:00 UTC",
        }
        response, _ = self.get("credit_rules/%s/" % (rule_id))
        etag = response[ETAG]
        # bandwidth_saver is on by default
        self.assertTrue(self.app.config["BANDWIDTH_SAVER"])
        self.assertTrue(self.app.config["PROJECTION"])
        r, status = self.put(rule_url, data=changes, headers=[("If-Match", etag)])
        self.assert200(status)
        self.assertPutResponse(r, "%s" % (rule_id))
        self.assertFalse("amount" in r)
        etag = r[self.app.config["ETAG"]]
        r, _ = self.get(rule_url, "")
        self.assertEqual(etag, r[self.app.config["ETAG"]])

        # test return all fields (bandwidth_saver off)
        self.app.config["BANDWIDTH_SAVER"] = False
        changes["name"] = "Give it all to me!"
        r, status = self.put(rule_url, data=changes, headers=[("If-Match", etag)])
        self.assert200(status)
        self.assertPutResponse(r, "%s" % (rule_id))
        self.assertTrue(
            all(["amount" in r, "duration" in r, "name" in r, "start" in r]),
            'One or more of "amount", "duration", "name", "start" is missing.',
        )
        self.assertTrue(r["name"] == "Give it all to me!")
        etag = r[self.app.config["ETAG"]]
        r, status = self.get(rule_url, "")
        self.assertEqual(etag, r[self.app.config["ETAG"]])

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 4:</b> &nbsp; 2 fragments, nominal size 11 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag596')" href="javascript:;">
eve-1.1.5/eve/tests/methods/patch.py: 851-862
</a>
<div class="mid" id="frag596" style="display:none"><pre>
    def assertPatchResponse(self, response, item_id, resource=None):
        id_field = self.domain[resource or self.known_resource]["id_field"]
        self.assertTrue(STATUS in response)
        self.assertTrue(STATUS_OK in response[STATUS])
        self.assertFalse(ISSUES in response)
        self.assertTrue(id_field in response)
        self.assertEqual(response[id_field], item_id)
        self.assertTrue(LAST_UPDATED in response)
        self.assertTrue(ETAG in response)
        self.assertTrue("_links" in response)
        self.assertItemLink(response["_links"], item_id)

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag653')" href="javascript:;">
eve-1.1.5/eve/tests/methods/put.py: 569-580
</a>
<div class="mid" id="frag653" style="display:none"><pre>
    def assertPutResponse(self, response, item_id, resource=None):
        id_field = self.domain[resource or self.known_resource]["id_field"]
        self.assertTrue(STATUS in response)
        self.assertTrue(STATUS_OK in response[STATUS])
        self.assertFalse(ISSUES in response)
        self.assertTrue(id_field in response)
        self.assertEqual(response[id_field], item_id)
        self.assertTrue(LAST_UPDATED in response)
        self.assertTrue(ETAG in response)
        self.assertTrue("_links" in response)
        self.assertItemLink(response["_links"], item_id)

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 5:</b> &nbsp; 2 fragments, nominal size 11 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag693')" href="javascript:;">
eve-1.1.5/eve/tests/methods/get.py: 249-261
</a>
<div class="mid" id="frag693" style="display:none"><pre>
    def test_get_where_mongo_objectid_as_string(self):
        where = '{"tid": "%s"}' % self.item_tid
        response, status = self.get(self.known_resource, "?where=%s" % where)
        self.assert200(status)
        resource = response["_items"]
        self.assertEqual(len(resource), 1)

        self.app.config["DOMAIN"]["contacts"]["query_objectid_as_string"] = True
        response, status = self.get(self.known_resource, "?where=%s" % where)
        self.assert200(status)
        resource = response["_items"]
        self.assertEqual(len(resource), 1)

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag694')" href="javascript:;">
eve-1.1.5/eve/tests/methods/get.py: 262-274
</a>
<div class="mid" id="frag694" style="display:none"><pre>
    def test_get_where_mongo_objectid_as_string_with_nested_documents(self):
        where = '{"tid": { "$in": ["%s"]}}' % self.item_tid
        response, status = self.get(self.known_resource, "?where=%s" % where)
        self.assert200(status)
        resource = response["_items"]
        self.assertEqual(len(resource), 1)

        self.app.config["DOMAIN"]["contacts"]["query_objectid_as_string"] = True
        response, status = self.get(self.known_resource, "?where=%s" % where)
        self.assert200(status)
        resource = response["_items"]
        self.assertEqual(len(resource), 1)

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 6:</b> &nbsp; 2 fragments, nominal size 18 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag702')" href="javascript:;">
eve-1.1.5/eve/tests/methods/get.py: 405-433
</a>
<div class="mid" id="frag702" style="display:none"><pre>
    def test_get_server_include_projection_can_exclude(self):
        """Test that static projection only expose fields included
        and support client projection on these fields.
        """
        # exclude `ref` by client side
        projection = '{"ref": 0}'
        response, status = self.get(
            self.different_resource, "?projection=%s" % projection
        )
        self.assert200(status)

        resource = response["_items"]

        # 'users' has a static inclusive projection with 'username' and 'ref'
        # fields, so other document fields should be excluded.
        # and client can further exclude 'ref' or 'username'.
        for r in resource:
            self.assertFalse("location" in r)
            self.assertFalse("role" in r)
            self.assertFalse("prog" in r)
            self.assertTrue("username" in r)
            self.assertFalse("ref" in r)
            self.assertTrue(self.domain[self.known_resource]["id_field"] in r)
            self.assertTrue(self.app.config["ETAG"] in r)
            self.assertTrue(self.app.config["LAST_UPDATED"] in r)
            self.assertTrue(self.app.config["DATE_CREATED"] in r)
            self.assertTrue(r[self.app.config["LAST_UPDATED"]] != self.epoch)
            self.assertTrue(r[self.app.config["DATE_CREATED"]] != self.epoch)

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag703')" href="javascript:;">
eve-1.1.5/eve/tests/methods/get.py: 434-459
</a>
<div class="mid" id="frag703" style="display:none"><pre>
    def test_get_server_include_projection_block_sniff(self):
        """Test that static projection only expose fields included
        and client projection on other fields will fail.
        """
        # shouldn't work when including `prog` (excluded) by client side
        projection = '{"prog": 1}'
        response, status = self.get(
            self.different_resource, "?projection=%s" % projection
        )
        self.assert200(status)

        resource = response["_items"]
        for r in resource:
            self.assertFalse("location" in r)
            self.assertFalse("role" in r)
            # shouldn't work
            self.assertFalse("prog" in r)
            self.assertFalse("username" in r)
            self.assertFalse("ref" in r)
            self.assertTrue(self.domain[self.known_resource]["id_field"] in r)
            self.assertTrue(self.app.config["ETAG"] in r)
            self.assertTrue(self.app.config["LAST_UPDATED"] in r)
            self.assertTrue(self.app.config["DATE_CREATED"] in r)
            self.assertTrue(r[self.app.config["LAST_UPDATED"]] != self.epoch)
            self.assertTrue(r[self.app.config["DATE_CREATED"]] != self.epoch)

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 7:</b> &nbsp; 2 fragments, nominal size 17 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag704')" href="javascript:;">
eve-1.1.5/eve/tests/methods/get.py: 460-486
</a>
<div class="mid" id="frag704" style="display:none"><pre>
    def test_get_server_exclude_projection_can_project_others(self):
        """Test that static projection expose fields other than excluded
        and support client projection on exposed fields.
        """
        projection = '{"prog": 1, "location":1}'
        response, status = self.get(
            self.different_resource_exclude, "?projection=%s" % projection
        )
        self.assert200(status)

        resource = response["_items"]

        # 'users' has a static inclusive projection with 'username' and 'ref'
        # fields, so other document fields should be excluded.
        # and client can further exclude 'ref' or 'username'.
        for r in resource:
            self.assertTrue("location" in r)
            self.assertFalse("role" in r)
            self.assertTrue("prog" in r)
            self.assertFalse("born" in r)
            self.assertTrue(self.domain[self.known_resource]["id_field"] in r)
            self.assertTrue(self.app.config["ETAG"] in r)
            self.assertTrue(self.app.config["LAST_UPDATED"] in r)
            self.assertTrue(self.app.config["DATE_CREATED"] in r)
            self.assertTrue(r[self.app.config["LAST_UPDATED"]] != self.epoch)
            self.assertTrue(r[self.app.config["DATE_CREATED"]] != self.epoch)

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag705')" href="javascript:;">
eve-1.1.5/eve/tests/methods/get.py: 487-510
</a>
<div class="mid" id="frag705" style="display:none"><pre>
    def test_get_server_exlcude_projection_can_sniff(self):
        """Test that static projection expose fields other than excluded
        and client projection on excluded **will work**.
        """
        projection = '{"born": 1}'
        response, status = self.get(
            self.different_resource_exclude, "?projection=%s" % projection
        )
        self.assert200(status)

        resource = response["_items"]
        for r in resource:
            self.assertFalse("location" in r)
            self.assertFalse("role" in r)
            self.assertFalse("prog" in r)
            # should work
            self.assertTrue("born" in r)
            self.assertTrue(self.domain[self.known_resource]["id_field"] in r)
            self.assertTrue(self.app.config["ETAG"] in r)
            self.assertTrue(self.app.config["LAST_UPDATED"] in r)
            self.assertTrue(self.app.config["DATE_CREATED"] in r)
            self.assertTrue(r[self.app.config["LAST_UPDATED"]] != self.epoch)
            self.assertTrue(r[self.app.config["DATE_CREATED"]] != self.epoch)

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 8:</b> &nbsp; 2 fragments, nominal size 26 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag809')" href="javascript:;">
eve-1.1.5/eve/tests/methods/get.py: 2330-2364
</a>
<div class="mid" id="frag809" style="display:none"><pre>
    def test_get_before_aggregation_hook(self):
        _db = self.connection[MONGO_DBNAME]
        _db.aggregate_test.insert_many(
            [
                {"x": 1, "tags": ["dog", "cat"]},
                {"x": 2, "tags": ["cat"]},
                {"x": 2, "tags": ["mouse", "cat", "dog"]},
                {"x": 3, "tags": []},
            ]
        )

        self.app.before_aggregation += self.devent

        self.app.register_resource(
            "aggregate_test",
            {
                "datasource": {
                    "aggregation": {
                        "pipeline": [
                            {"$unwind": "$tags"},
                            {"$group": {"_id": "$tags", "count": {"$sum": "$field1"}}},
                        ]
                    }
                }
            },
        )

        response, status = self.get("aggregate_test?aggregate=ciao")
        self.assert400(status)
        self.assertTrue(self.devent.called is None)

        response, status = self.get('aggregate_test?aggregate={"$field1":1}')
        self.assert200(status)
        self.assertEqual("aggregate_test", self.devent.called[0])

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag810')" href="javascript:;">
eve-1.1.5/eve/tests/methods/get.py: 2365-2399
</a>
<div class="mid" id="frag810" style="display:none"><pre>
    def test_get_after_aggregation_hook(self):
        _db = self.connection[MONGO_DBNAME]
        _db.aggregate_test.insert_many(
            [
                {"x": 1, "tags": ["dog", "cat"]},
                {"x": 2, "tags": ["cat"]},
                {"x": 2, "tags": ["mouse", "cat", "dog"]},
                {"x": 3, "tags": []},
            ]
        )

        self.app.after_aggregation += self.devent

        self.app.register_resource(
            "aggregate_test",
            {
                "datasource": {
                    "aggregation": {
                        "pipeline": [
                            {"$unwind": "$tags"},
                            {"$group": {"_id": "$tags", "count": {"$sum": "$field1"}}},
                        ]
                    }
                }
            },
        )

        response, status = self.get("aggregate_test?aggregate=ciao")
        self.assert400(status)
        self.assertTrue(self.devent.called is None)

        response, status = self.get('aggregate_test?aggregate={"$field1":1}')
        self.assert200(status)
        self.assertEqual("aggregate_test", self.devent.called[0])

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 9:</b> &nbsp; 2 fragments, nominal size 13 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag851')" href="javascript:;">
eve-1.1.5/eve/tests/methods/common.py: 623-636
</a>
<div class="mid" id="frag851" style="display:none"><pre>
    def test_patch_oplog(self):
        self.headers.append(("If-Match", self.item_etag))
        r = self.test_client.patch(
            self.item_id_url,
            data=json.dumps(self.data),
            headers=self.headers,
            environ_base={"REMOTE_ADDR": "127.0.0.1"},
        )
        r, status = self.oplog_get()
        self.assert200(status)
        self.assertEqual(len(r["_items"]), 1)
        oplog_entry = r["_items"][0]
        self.assertOpLogEntry(oplog_entry, "PATCH")

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag852')" href="javascript:;">
eve-1.1.5/eve/tests/methods/common.py: 637-650
</a>
<div class="mid" id="frag852" style="display:none"><pre>
    def test_put_oplog(self):
        self.headers.append(("If-Match", self.item_etag))
        r = self.test_client.put(
            self.item_id_url,
            data=json.dumps(self.data),
            headers=self.headers,
            environ_base={"REMOTE_ADDR": "127.0.0.1"},
        )
        r, status = self.oplog_get()
        self.assert200(status)
        self.assertEqual(len(r["_items"]), 1)
        oplog_entry = r["_items"][0]
        self.assertOpLogEntry(oplog_entry, "PUT")

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 10:</b> &nbsp; 3 fragments, nominal size 14 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag856')" href="javascript:;">
eve-1.1.5/eve/tests/methods/common.py: 699-713
</a>
<div class="mid" id="frag856" style="display:none"><pre>
    def test_post_oplog_with_basic_auth(self):
        self.domain["contacts"]["authentication"] = ValidBasicAuth
        self.headers.append(("Authorization", "Basic YWRtaW46c2VjcmV0"))
        r = self.test_client.post(
            self.known_resource_url,
            data=json.dumps(self.data),
            headers=self.headers,
            environ_base={"REMOTE_ADDR": "127.0.0.1"},
        )
        r, status = self.oplog_get()
        self.assert200(status)
        self.assertEqual(len(r["_items"]), 1)
        oplog_entry = r["_items"][0]
        self.assertOpLogEntry(oplog_entry, "POST", "admin")

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag858')" href="javascript:;">
eve-1.1.5/eve/tests/methods/common.py: 729-743
</a>
<div class="mid" id="frag858" style="display:none"><pre>
    def test_post_oplog_with_hmac_auth(self):
        self.domain["contacts"]["authentication"] = ValidHMACAuth
        self.headers.append(("Authorization", "admin:secret"))
        r = self.test_client.post(
            self.known_resource_url,
            data=json.dumps(self.data),
            headers=self.headers,
            environ_base={"REMOTE_ADDR": "127.0.0.1"},
        )
        r, status = self.oplog_get()
        self.assert200(status)
        self.assertEqual(len(r["_items"]), 1)
        oplog_entry = r["_items"][0]
        self.assertOpLogEntry(oplog_entry, "POST", "admin")

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag857')" href="javascript:;">
eve-1.1.5/eve/tests/methods/common.py: 714-728
</a>
<div class="mid" id="frag857" style="display:none"><pre>
    def test_post_oplog_with_token_auth(self):
        self.domain["contacts"]["authentication"] = ValidTokenAuth
        self.headers.append(("Authorization", "Basic dGVzdF90b2tlbjo="))
        r = self.test_client.post(
            self.known_resource_url,
            data=json.dumps(self.data),
            headers=self.headers,
            environ_base={"REMOTE_ADDR": "127.0.0.1"},
        )
        r, status = self.oplog_get()
        self.assert200(status)
        self.assertEqual(len(r["_items"]), 1)
        oplog_entry = r["_items"][0]
        self.assertOpLogEntry(oplog_entry, "POST", "test_token")

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 11:</b> &nbsp; 2 fragments, nominal size 11 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag886')" href="javascript:;">
eve-1.1.5/eve/tests/versioning.py: 270-283
</a>
<div class="mid" id="frag886" style="display:none"><pre>
    def do_test_put(self, partial):
        response, status = self.put(
            self.item_id_url,
            data=self.item_change,
            headers=[("If-Match", self.item_etag)],
        )
        self.assertGoodPutPatch(response, status)
        self.assertPrimaryAndShadowDocuments(self.item_id, 2, partial=partial)

        document = self.directGetDocument(self.item_id)
        self.assertEqualFields(self.item_change, document, self.fields)

        self.assertTrue(self.countShadowDocuments(self.item_id) == 2)

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag887')" href="javascript:;">
eve-1.1.5/eve/tests/versioning.py: 284-297
</a>
<div class="mid" id="frag887" style="display:none"><pre>
    def do_test_patch(self, partial):
        response, status = self.patch(
            self.item_id_url,
            data=self.item_change,
            headers=[("If-Match", self.item_etag)],
        )
        self.assertGoodPutPatch(response, status)
        self.assertPrimaryAndShadowDocuments(self.item_id, 2, partial=partial)

        document = self.directGetDocument(self.item_id)
        self.assertEqualFields(self.item_change, document, self.fields)

        self.assertTrue(self.countShadowDocuments(self.item_id) == 2)

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 12:</b> &nbsp; 2 fragments, nominal size 12 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag936')" href="javascript:;">
eve-1.1.5/eve/tests/versioning.py: 1324-1346
</a>
<div class="mid" id="frag936" style="display:none"><pre>
    def test_put(self):
        """Make sure that Eve jumps to version = 2 and saves two shadow copies
        (version 1 and version 2) for documents that where already in the
        database before version control was turned on.
        """
        # make sure there are no shadow documents
        self.assertTrue(self.countShadowDocuments() == 0)

        # put a change
        changes = {"ref": "this is a different value"}
        response, status = self.put(
            self.item_id_url, data=changes, headers=[("If-Match", self.item_etag)]
        )
        self.assertGoodPutPatch(response, status)
        self.assertDocumentVersionFields(response, 2)

        # make sure that this saved to the db (if it didn't, version == 1)
        self.assertTrue(self.countShadowDocuments() == 2)
        response2, status = self.get(self.known_resource, item=self.item_id)
        self.assert200(status)
        self.assertDocumentVersionFields(response2, 2)
        self.assertEqual(response[ETAG], response2[ETAG])

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag937')" href="javascript:;">
eve-1.1.5/eve/tests/versioning.py: 1347-1369
</a>
<div class="mid" id="frag937" style="display:none"><pre>
    def test_patch(self):
        """Make sure that Eve jumps to version = 2 and saves two shadow copies
        (version 1 and version 2) for documents that where already in the
        database before version control was turned on.
        """
        # make sure there are no shadow documents
        self.assertTrue(self.countShadowDocuments() == 0)

        # patch a change
        changes = {"ref": "this is a different value"}
        response, status = self.patch(
            self.item_id_url, data=changes, headers=[("If-Match", self.item_etag)]
        )
        self.assertGoodPutPatch(response, status)
        self.assertDocumentVersionFields(response, 2)

        # make sure that this saved to the db (if it didn't, version == 1)
        self.assertTrue(self.countShadowDocuments() == 2)
        response2, status = self.get(self.known_resource, item=self.item_id)
        self.assert200(status)
        self.assertDocumentVersionFields(response2, 2)
        self.assertEqual(response[ETAG], response2[ETAG])

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 13:</b> &nbsp; 2 fragments, nominal size 12 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag999')" href="javascript:;">
eve-1.1.5/eve/tests/__init__.py: 532-544
</a>
<div class="mid" id="frag999" style="display:none"><pre>
    def random_payments(self, num):
        payments = []
        for i in range(num):
            dt = datetime.utcnow().replace(microsecond=0)
            payment = {
                "a_string": self.random_string(10),
                "a_number": i,
                eve.LAST_UPDATED: dt,
                eve.DATE_CREATED: dt,
            }
            payments.append(payment)
        return payments

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1006')" href="javascript:;">
eve-1.1.5/eve/tests/__init__.py: 597-609
</a>
<div class="mid" id="frag1006" style="display:none"><pre>
    def random_internal_transactions(self, num):
        transactions = []
        for i in range(num):
            dt = datetime.utcnow().replace(microsecond=0)
            transaction = {
                "internal_string": self.random_string(10),
                "internal_number": i,
                eve.LAST_UPDATED: dt,
                eve.DATE_CREATED: dt,
            }
            transactions.append(transaction)
        return transactions

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<script language="JavaScript">
function ShowHide(divId) { 
    if(document.getElementById(divId).style.display == 'none') {
        document.getElementById(divId).style.display='block';
    } else { 
        document.getElementById(divId).style.display = 'none';
    } 
}
</script>
</body>
</html>
