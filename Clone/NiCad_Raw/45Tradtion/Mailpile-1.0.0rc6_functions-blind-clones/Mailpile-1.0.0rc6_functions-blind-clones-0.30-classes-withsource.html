<html>
<head>
    <title>NiCad6 Clone Report</title>
    <style type="text/css">
        body {font-family:sans-serif;}
        table {background-color:white; border:0px; padding:0px; border-spacing:4px; width:auto; margin-left:30px; margin-right:auto;}
        td {background-color:rgba(192,212,238,0.8); border:0px; padding:8px; width:auto; vertical-align:top; border-radius:8px}
        pre {background-color:white; padding:4px;}
        a {color:darkblue;}
    </style>
</head>
<body>
<h2>NiCad6 Clone Report</h2>
<table>
<tr style="font-size:14pt">
<td><b>System:</b> &nbsp; Mailpile-1.0.0rc6</td>
<td><b>Clone pairs:</b> &nbsp; 17</td>
<td><b>Clone classes:</b> &nbsp; 14</td>
</tr>
<tr style="font-size:12pt">
<td style="background-color:white">Clone type: &nbsp; 3-2</td>
<td style="background-color:white">Granularity: &nbsp; functions-blind</td>
<td style="background-color:white">Max diff threshold: &nbsp; 30%</td>
<td style="background-color:white">Clone size: &nbsp; 10 - 2500 lines</td>
<td style="background-color:white">Total functions-blind: &nbsp; 2699</td>
</tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 1:</b> &nbsp; 2 fragments, nominal size 14 lines, similarity 80%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag127')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/mail_source/local.py: 47-62
</a>
<div class="mid" id="frag127" style="display:none"><pre>
    def open(self):
        with self._lock:
            mailboxes = self.my_config.mailbox.values()
            if self.watching == len(mailboxes):
                return True
            else:
                self.watching = len(mailboxes)

            # Prepare the data section of our event, for keeping state.
            for d in ('mailbox_state', ):
                if d not in self.event.data:
                    self.event.data[d] = {}

        self._log_status(_('Watching %d mbox mailboxes') % self.watching)
        return True

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag151')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/mail_source/pop3.py: 93-111
</a>
<div class="mid" id="frag151" style="display:none"><pre>
    def open(self):
        with self._lock:
            mailboxes = self.my_config.mailbox.values()
            if self.watching == len(mailboxes):
                return True
            else:
                self.watching = len(mailboxes)

            for d in ('mailbox_state', ):
                if d not in self.event.data:
                    self.event.data[d] = {}
            self.event.data['connection'] = {
                'live': False,
                'error': [False, _('Nothing is wrong')]
            }

        self._log_status(_('Watching %d POP3 mailboxes') % self.watching)
        return True

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 2:</b> &nbsp; 2 fragments, nominal size 13 lines, similarity 92%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag812')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/tests/test_eventlog.py: 89-101
</a>
<div class="mid" id="frag812" style="display:none"><pre>
    def test_event_as_dict(self):
        cmd = self.mp.help()
        evt = mailpile.eventlog.Event(source=cmd, data={ 'name' : 'testing'}, message="hello world", private_data={ 'x' : 22})
        res = evt.as_dict()
        self.assertEqual(res['message'], "hello world")
        self.assertEqual(res['data'], { 'name' : 'testing'})
        self.assertIsNotNone( EVENT_ID_RE.match(res['event_id']) )
        self.assertEqual(res['private_data'], { 'x' : 22})
        self.assertIsNotNone( res['flags'] )
        self.assertIsNotNone( res['source'] )
        self.assertIsNotNone( res['date'] )
        self.assertTrue( isinstance(res['ts'], float) )

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag814')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/tests/test_eventlog.py: 109-122
</a>
<div class="mid" id="frag814" style="display:none"><pre>
    def test_event_as_json(self):
        cmd = self.mp.help()
        evt = mailpile.eventlog.Event(source=cmd, data={ 'name' : 'testing'}, message="hello world", private_data={ 'x' : 22})
        json_res = evt.as_json()
        res = json.loads(json_res)
        self.assertEqual(res['message'], "hello world")
        self.assertEqual(res['data'], { 'name' : 'testing'})
        self.assertIsNotNone( EVENT_ID_RE.match(res['event_id']) )
        self.assertEqual(res['private_data'], { 'x' : 22})
        self.assertIsNotNone( res['flags'] )
        self.assertIsNotNone( res['source'] )
        self.assertIsNotNone( res['date'] )
        self.assertTrue( isinstance(res['ts'], float) )

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 3:</b> &nbsp; 3 fragments, nominal size 10 lines, similarity 75%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag859')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/tests/test_config.py: 254-264
</a>
<div class="mid" id="frag859" style="display:none"><pre>
    def test_UrlCheck_valid(self):
        valid_urls = [
          "http://site.io",
          "https://localhost",
          "git://github.com/user/repo.git",
          "magnet:?xt=urn:sha1:1C6HTVCWBTRNJ9V4XNAE52SJUQCZO5D",
        ]
        for v in valid_urls:
            res = validators.UrlCheck(v)
            self.assertEqual(res, v)

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag860')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/tests/test_config.py: 265-278
</a>
<div class="mid" id="frag860" style="display:none"><pre>
    def test_UrlCheck_invalid(self):
        invalid_urls = [
          "obvious",
          "",
          " ",
          ".com",
          "/just/a/path",
        ]
        for i in invalid_urls:
            self.assertRaises(ValueError, lambda: validators.UrlCheck(i))

    #
    #config._EmailCheck should verify that an email address has an @ symbol
    #
</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag861')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/tests/test_config.py: 279-293
</a>
<div class="mid" id="frag861" style="display:none"><pre>
    def test_EmailCheck_valid(self):
        valid_emails = [
          '"This is a valid email!"@believe.it',
          'this.address(has-a-comment)@crazy-but-true.com',
          '"ABC\@def"@valid-email.com',
          '\$A12345@valid-email.com',
          '!def!xyz%abc@valid-email.com',
          '_somename@valid-email.com',
          '"Some\\Body"@valid-email.com'
        ]

        for v in valid_emails:
            res = validators.EmailCheck(v)
            self.assertEqual(res, v)

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 4:</b> &nbsp; 2 fragments, nominal size 24 lines, similarity 80%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag1037')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/plugins/vcard_gnupg.py: 129-154
</a>
<div class="mid" id="frag1037" style="display:none"><pre>
    def vcards_per_key(cls, keys, vcards):
        """This creates on VCards per key"""
        new_vcards = []
        for key_id, key in keys.iteritems():
            if cls.key_is_useless(key):
                continue
            vcls = [cls.key_vcl(key_id, key)]
            emails = []
            for uid in key.get('uids', []):
                if uid.get('email'):
                    vcls.append(VCardLine(name='email', value=uid['email']))
                    emails.append(uid['email'])
                if uid.get('name'):
                    name = uid['name']
                    vcls.append(VCardLine(name='fn', value=name))
            if emails:
                # This is us taking care to only create one card for each
                # set of e-mail addresses.
                card = MailpileVCard(*vcls)
                card.add(VCardLine(name='x-gpg-mrgid', value=key_id))
                for email in emails:
                    if email not in vcards:
                        vcards[email] = card
                new_vcards.append(card)
        return new_vcards

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1038')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/plugins/vcard_gnupg.py: 156-184
</a>
<div class="mid" id="frag1038" style="display:none"><pre>
    def vcards_merged(cls, keys, vcards):
        """This creates merged VCards, grouping by uid/e-mail and key"""
        new_vcards = []
        for key_id, key in keys.iteritems():
            if cls.key_is_useless(key):
                continue
            vcls = [cls.key_vcl(key_id, key)]
            card = None
            emails = []
            for uid in key.get('uids', []):
                if uid.get('email'):
                    vcls.append(VCardLine(name='email', value=uid['email']))
                    card = card or vcards.get(uid['email'])
                    emails.append(uid['email'])
                if uid.get('name'):
                    name = uid['name']
                    vcls.append(VCardLine(name='fn', value=name))
            if card and emails:
                card.add(*vcls)
            elif emails:
                # This is us taking care to only create one card for each
                # set of e-mail addresses.
                card = MailpileVCard(*vcls)
                card.add(VCardLine(name='x-gpg-mrgid', value=key_id))
                for email in emails:
                    vcards[email] = card
                new_vcards.append(card)
        return new_vcards

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 5:</b> &nbsp; 2 fragments, nominal size 15 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag1061')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/plugins/vcard_libravatar.py: 44-66
</a>
<div class="mid" id="frag1061" style="display:none"><pre>
    def _want_update(self):
        def _jittery_time():
            # This introduces 5 hours of jitter into the time check
            # below, biased towards extending the delay by an average
            # of 1.5 hours each time. This is mostly done to spread
            # out the load on the Libravatar server over time, as to
            # begin with all contacts will be checked at roughly the
            # same time.
            return time.time() + random.randrange(-14400, 3600)

        want = []
        vcards = self.session.config.vcards
        for vcard in vcards.find_vcards([], kinds=vcards.KINDS_PEOPLE):
            try:
                ts = int(vcard.get(self.VCARD_TS).value)
            except IndexError:
                ts = 0
            if ts &lt; _jittery_time() - (self.config.interval * 24 * 3600):
                want.append(vcard)
            if len(want) &gt;= self.config.batch:
                break
        return want

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1275')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/plugins/vcard_gravatar.py: 46-67
</a>
<div class="mid" id="frag1275" style="display:none"><pre>
    def _want_update(self):
        def _jittery_time():
            # This introduces 5 hours of jitter into the time check below,
            # biased towards extending the delay by an average of 1.5 hours
            # each time. This is mostly done to spread out the load on the
            # Gravatar server over time, as to begin with all contacts will
            # be checked at roughly the same time.
            return time.time() + random.randrange(-14400, 3600)

        want = []
        vcards = self.session.config.vcards
        for vcard in vcards.find_vcards([], kinds=vcards.KINDS_PEOPLE):
            try:
                ts = int(vcard.get(self.VCARD_TS).value)
            except IndexError:
                ts = 0
            if ts &lt; _jittery_time() - (self.config.interval * 24 * 3600):
                want.append(vcard)
            if len(want) &gt;= self.config.batch:
                break
        return want

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 6:</b> &nbsp; 2 fragments, nominal size 25 lines, similarity 92%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag1064')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/plugins/vcard_libravatar.py: 73-111
</a>
<div class="mid" id="frag1064" style="display:none"><pre>
    def check_libravatar(self, vcard, email):
        img = vcf = json = None
        for vcl in vcard.get_all('email'):
            digest = mailpile.util.md5_hex(vcl.value.lower())
            try:
                if mailpile.util.QUITTING:
                    return None, None, None, None
                if not img:
                    img = self._get(('%s/avatar/%s?s=%s&amp;r=%s&amp;d=404'
                                     ) % (self.config.url,
                                          digest,
                                          self.config.size,
                                          self.config.rating))

                # FIXME
                #if not vcf:
                #    vcf = self._get('%s/%s.vcf' % (self.config.url, digest))

                # FIXME
                #if not json:
                #    json = self._get('%s/%s.json' % (self.config.url, digest))

                if img or vcf or json:
                    email = vcl.value
            except IOError:
                pass

        if (self.config.default != '404') and not img:
            try:
                img = self._get(('%s/avatar/%s?s=%s&amp;d=%s'
                                 ) % (self.config.url,
                                      mailpile.util.md5_hex(email.lower()),
                                      self.config.size,
                                      self.config.default))
            except IOError:
                pass

        return email, img, vcf, json

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1278')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/plugins/vcard_gravatar.py: 74-112
</a>
<div class="mid" id="frag1278" style="display:none"><pre>
    def check_gravatar(self, vcard, email):
        img = vcf = json = None
        for vcl in vcard.get_all('email'):
            digest = md5_hex(vcl.value.lower())
            try:
                if mailpile.util.QUITTING:
                    return None, None, None, None
                if not img:
                    img = self._get(('%s/avatar/%s.jpg?s=%s&amp;r=%s&amp;d=404'
                                     ) % (self.config.url,
                                          digest,
                                          self.config.size,
                                          self.config.rating))

                # FIXME
                #if not vcf:
                #    vcf = self._get('%s/%s.vcf' % (self.config.url, digest))

                # FIXME
                #if not json:
                #    json = self._get('%s/%s.json' % (self.config.url, digest))

                if img or vcf or json:
                    email = vcl.value
            except IOError:
                pass

        if (self.config.default != '404') and not img:
            try:
                img = self._get(('%s/avatar/%s.jpg?s=%s&amp;d=%s'
                                 ) % (self.config.url,
                                      md5_hex(email.lower()),
                                      self.config.size,
                                      self.config.default))
            except IOError:
                pass

        return email, img, vcf, json

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 7:</b> &nbsp; 2 fragments, nominal size 28 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag1065')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/plugins/vcard_libravatar.py: 112-153
</a>
<div class="mid" id="frag1065" style="display:none"><pre>
    def get_vcards(self):
        if not self.config.active:
            return []

        def _b64(data):
            return data.encode('base64').replace('\n', '')

        results = []
        for contact in self._want_update():
            email = contact.email
            if not email:
                continue

            if mailpile.util.QUITTING:
                return []

            vcard = MailpileVCard(VCardLine(name=self.VCARD_TS,
                                            value=int(time.time())))
            email, img, gcard, gjson = self.check_libravatar(contact, email)

            if gcard:
                # FIXME: Is this boring?
                # vcard.load(data=gcard)
                pass

            if gjson:
                # FIXME: This is less boring!
                pass

            if img:
                vcard.add(VCardLine(
                    name='photo',
                    value='data:image/jpeg;base64,%s' % _b64(img),
                    mediatype='image/jpeg'
                ))

            if gcard or gjson or img:
                vcard.add(VCardLine(name='email', value=email))
                results.append(vcard)
        return results


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1279')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/plugins/vcard_gravatar.py: 113-154
</a>
<div class="mid" id="frag1279" style="display:none"><pre>
    def get_vcards(self):
        if not self.config.active:
            return []

        def _b64(data):
            return data.encode('base64').replace('\n', '')

        results = []
        for contact in self._want_update():
            email = contact.email
            if not email:
                continue

            if mailpile.util.QUITTING:
                return []

            vcard = MailpileVCard(VCardLine(name=self.VCARD_TS,
                                            value=int(time.time())))
            email, img, gcard, gjson = self.check_gravatar(contact, email)

            if gcard:
                # FIXME: Is this boring?
                # vcard.load(data=gcard)
                pass

            if gjson:
                # FIXME: This is less boring!
                pass

            if img:
                vcard.add(VCardLine(
                    name='photo',
                    value='data:image/jpeg;base64,%s' % _b64(img),
                    mediatype='image/jpeg'
                ))

            if gcard or gjson or img:
                vcard.add(VCardLine(name='email', value=email))
                results.append(vcard)
        return results


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 8:</b> &nbsp; 2 fragments, nominal size 36 lines, similarity 91%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag1094')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/plugins/compose.py: 553-596
</a>
<div class="mid" id="frag1094" style="display:none"><pre>
    def command(self):
        session, config, idx = self.session, self.session.config, self._idx()
        reply_all = False
        ephemeral = False
        args = list(self.args)
        if not args:
            args = ["=%s" % x for x in self.data.get('mid', [])]
            ephemeral = truthy((self.data.get('ephemeral') or [False])[0])
            reply_all = truthy((self.data.get('reply_all') or [False])[0])
        else:
            while args:
                if args[0].lower() == 'all':
                    reply_all = args.pop(0) or True
                elif args[0].lower() == 'ephemeral':
                    ephemeral = args.pop(0) or True
                else:
                    break

        # Make sure GET does not change backend state, allow on CLI.
        if self.data.get('_method', 'POST') != 'POST':
            ephemeral = True

        refs = [Email(idx, i) for i in self._choose_messages(args)]
        if refs:
            try:
                cid = self.data.get('cid', [None])[0]
                email, ephemeral = self.CreateReply(idx, session, refs,
                                                    self._new_msgid(),
                                                    reply_all=reply_all,
                                                    cid=cid,
                                                    ephemeral=ephemeral)
            except NoFromAddressError:
                return self._error(_('You must configure a '
                                     'From address first.'))

            if not ephemeral:
                self._track_action('replied', refs)
                self._tag_blank([email])

            return self._edit_messages([email], ephemeral=ephemeral)
        else:
            return self._error(_('No message found'))


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1096')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/plugins/compose.py: 658-702
</a>
<div class="mid" id="frag1096" style="display:none"><pre>
    def command(self):
        session, config, idx = self.session, self.session.config, self._idx()

        with_atts = False
        ephemeral = False
        args = list(self.args)
        if not args:
            args = ["=%s" % x for x in self.data.get('mid', [])]
            ephemeral = truthy((self.data.get('ephemeral') or [False])[0])
            with_atts = truthy((self.data.get('atts') or [False])[0])
        else:
            while args:
                if args[0].lower() == 'att':
                    with_atts = args.pop(0) or True
                elif args[0].lower() == 'ephemeral':
                    ephemeral = args.pop(0) or True
                else:
                    break

        # Make sure GET does not change backend state
        if self.data.get('_method', 'POST') != 'POST':
            ephemeral = True

        if ephemeral and with_atts:
            raise UsageError(_('Sorry, ephemeral messages cannot have '
                               'attachments at this time.'))

        refs = [Email(idx, i) for i in self._choose_messages(args)]
        if refs:
            cid = self.data.get('cid', [None])[0]
            email, ephemeral = self.CreateForward(idx, session, refs,
                                                  self._new_msgid(),
                                                  with_atts=with_atts,
                                                  cid=cid,
                                                  ephemeral=ephemeral)

            if not ephemeral:
                self._track_action('fwded', refs)
                self._tag_blank([email])

            return self._edit_messages([email], ephemeral=ephemeral)
        else:
            return self._error(_('No message found'))


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 9:</b> &nbsp; 2 fragments, nominal size 14 lines, similarity 73%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag1213')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/plugins/gui.py: 74-89
</a>
<div class="mid" id="frag1213" style="display:none"><pre>
    def _state_need_setup(self, in_state):
        if in_state:
            self._do('set_status', status='attention')
            self._do('set_status_display',
                id="logged-in",
                color='#333',
                icon='image:new-setup',
                title=_('Brand new installation!'),
                details=(
                    _('This appears to be a new installation of Mailpile!')
                    + '\n' +
                    _('You need to choose a language, password and privacy policy.')
                    + '\n' +
                    _('To proceed, open Mailpile in your web browser.')))
            self._do('set_item', id='open', label=_("Get Started!"))

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1214')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/plugins/gui.py: 90-103
</a>
<div class="mid" id="frag1214" style="display:none"><pre>
    def _state_please_log_in(self, in_state):
        if in_state:
            self._do('set_status', status='attention')
            self._do('set_status_display',
                id="logged-in",
                color='#333',
                icon='image:logged-out',
                title=_('Not logged in'),
                details=(_('Your data is stored encrypted and is'
                           ' inaccessible until you log in.')
                         + '\n' +
                         _('To proceed, open Mailpile in your web browser.')))
            self._do('set_item', id='open', label=_("Log In"))

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 10:</b> &nbsp; 2 fragments, nominal size 13 lines, similarity 92%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag1365')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/plugins/__init__.py: 505-518
</a>
<div class="mid" id="frag1365" style="display:none"><pre>

    def register_config_variables(self, *args):
        self._compat_check()
        args = list(args)
        rules = args.pop(-1)
        dest = mailpile.config.defaults.CONFIG_RULES
        path = '/'.join(args)
        for arg in args:
            dest = dest[arg][-1]
        for rname, rule in rules.iteritems():
            if rname in dest:
                raise PluginError('Variable already exist: %s/%s' % (path, rname))
            else:
                dest[rname] = rule
</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1366')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/plugins/__init__.py: 519-535
</a>
<div class="mid" id="frag1366" style="display:none"><pre>

    def register_config_section(self, *args):
        self._compat_check()
        args = list(args)
        rules = args.pop(-1)
        rname = args.pop(-1)
        dest = mailpile.config.defaults.CONFIG_RULES
        path = '/'.join(args)
        for arg in args:
            dest = dest[arg][-1]
        if rname in dest:
            raise PluginError('Section already exist: %s/%s' % (path, rname))
        else:
            dest[rname] = rules


    ##[ Pluggable message transformations ]###################################
</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 11:</b> &nbsp; 2 fragments, nominal size 10 lines, similarity 70%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag1367')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/plugins/__init__.py: 541-551
</a>
<div class="mid" id="frag1367" style="display:none"><pre>

    def _txf_in(self, transforms, config, msg, kwargs):
        matched = 0
        for name in sorted(transforms.keys()):
            txf = transforms[name](config)
            msg, match, cont = txf.TransformIncoming(msg, **kwargs)
            if match:
                matched += 1
            if not cont:
                break
        return msg, matched
</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1368')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/plugins/__init__.py: 552-562
</a>
<div class="mid" id="frag1368" style="display:none"><pre>

    def _txf_out(self, transforms, cfg, s, r, msg, kwa):
        matched = 0
        for name in sorted(transforms.keys()):
            txf = transforms[name](cfg)
            s, r, msg, match, cont = txf.TransformOutgoing(s, r, msg, **kwa)
            if match:
                matched += 1
            if not cont:
                break
        return s, r, msg, matched
</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 12:</b> &nbsp; 2 fragments, nominal size 13 lines, similarity 71%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag1710')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/config/paths.py: 51-79
</a>
<div class="mid" id="frag1710" style="display:none"><pre>
def DEFAULT_SHARED_DATADIR():
    # IMPORTANT: This code is duplicated in mailpile-admin.py.
    #            If it needs changing please change both places!
    env_share = os.getenv('MAILPILE_SHARED')
    if env_share is not None:
        return env_share

    # Check if we are running in a virtual env
    # http://stackoverflow.com/questions/1871549/python-determine-if-running-inside-virtualenv
    # We must also check that we are installed in the virtual env,
    # not just that we are running in a virtual env.
    if ((hasattr(sys, 'real_prefix') or hasattr(sys, 'base_prefix'))
            and __file__.startswith(sys.prefix)):
        return os.path.join(sys.prefix, 'share', 'mailpile')

    # Check if we've been installed to /usr/local (or equivalent)
    usr_local = os.path.join(sys.prefix, 'local')
    if __file__.startswith(usr_local):
        return os.path.join(usr_local, 'share', 'mailpile')

    # Check if we are in /usr/ (sys.prefix)
    if __file__.startswith(sys.prefix):
        return os.path.join(sys.prefix, 'share', 'mailpile')

    # Else assume dev mode, source tree layout
    return os.path.join(
        os.path.dirname(__file__), '..', '..', 'shared-data')


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag2506')" href="javascript:;">
Mailpile-1.0.0rc6/shared-data/multipile/mailpile-admin.py: 321-353
</a>
<div class="mid" id="frag2506" style="display:none"><pre>
def get_mailpile_shared_datadir():
    # IMPORTANT: This code is duplicated in mailpile/config.py.
    #            If it needs changing please change both places!
    #
    # Why? The code is duplicated here, so when running in CGI mode
    # we don't have to load &amp; parse the full Mailpile app just to
    # find this path.
    #
    env_share = os.getenv('MAILPILE_SHARED')
    if env_share is not None:
        return env_share

    # Check if we are running in a virtual env
    # http://stackoverflow.com/questions/1871549/python-determine-if-running-inside-virtualenv
    # We must also check that we are installed in the virtual env,
    # not just that we are running in a virtual env.
    if (hasattr(sys, 'real_prefix') or hasattr(sys, 'base_prefix')) and __file__.startswith(sys.prefix):
        return os.path.join(sys.prefix, 'share', 'mailpile')

    # Check if we've been installed to /usr/local (or equivalent)
    usr_local = os.path.join(sys.prefix, 'local')
    if __file__.startswith(usr_local):
        return os.path.join(usr_local, 'share', 'mailpile')

    # Check if we are in /usr/ (sys.prefix)
    if __file__.startswith(sys.prefix):
        return os.path.join(sys.prefix, 'share', 'mailpile')

    # Else assume dev mode, source tree layout
    # NOTE: This differs from mailpile/config.py!
    return os.path.realpath(os.path.join(os.path.dirname(__file__), '..'))


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 13:</b> &nbsp; 3 fragments, nominal size 11 lines, similarity 75%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag2160')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/www/jinjaextensions.py: 477-493
</a>
<div class="mid" id="frag2160" style="display:none"><pre>
    def _show_message_signature(self, status):
        # This avoids crashes when attributes are missing.
        try:
            if status.startswith('hack the planet'):
                pass
        except UndefinedError:
            status = ''

        color, icon, text, message = self._STATUS_SIGNATURE.get(status, self._DEFAULT_SIGNATURE)

        return {
            'color': color,
            'icon': icon,
            'text': text,
            'message': message
        }

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag2163')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/www/jinjaextensions.py: 607-621
</a>
<div class="mid" id="frag2163" style="display:none"><pre>
    def _show_crypto_policy(self, policy):
        # This avoids crashes when attributes are missing.
        try:
            if policy.startswith('hack the planet'):
                pass
        except UndefinedError:
            policy = ''

        text, message = self._CRYPTO_POLICY.get(policy, self._DEFAULT_CRYPTO_POLICY)

        return {
            'text': text,
            'message': message
        }

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag2162')" href="javascript:;">
Mailpile-1.0.0rc6/mailpile/www/jinjaextensions.py: 566-582
</a>
<div class="mid" id="frag2162" style="display:none"><pre>
    def _show_message_encryption(self, status):
        # This avoids crashes when attributes are missing.
        try:
            if status.startswith('hack the planet'):
                pass
        except UndefinedError:
            status = ''

        color, icon, text, message = self._STATUS_ENCRYPTION.get(status, self._DEFAULT_ENCRYPTION)

        return {
            'color': color,
            'icon': icon,
            'text': text,
            'message': message
        }

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 14:</b> &nbsp; 2 fragments, nominal size 16 lines, similarity 82%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag2566')" href="javascript:;">
Mailpile-1.0.0rc6/packages/scripts/kite-runner.py: 332-348
</a>
<div class="mid" id="frag2566" style="display:none"><pre>
def kite_runner_main(args):
    try:
        bb = BuildbotServer()
        bb.parse_args(args).run()
    except (getopt.GetoptError, ArgumentError):
        print(__doc__)
        traceback.print_exc()
        sys.exit(1)
    except (RuntimeError, KeyboardInterrupt):
        print('Quitting...')
    except Exception:
        traceback.print_exc()
        sys.exit(2)
    finally:
        bb.cleanup()


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag2580')" href="javascript:;">
Mailpile-1.0.0rc6/packages/scripts/build-controller.py: 128-146
</a>
<div class="mid" id="frag2580" style="display:none"><pre>
    def Main(cls, args):
        bc = None
        try:
            bc = cls()
            bc.parse_args(args).run()
        except (getopt.GetoptError, ArgumentError):
            print(__doc__)
            traceback.print_exc()
            sys.exit(1)
        except (RuntimeError, KeyboardInterrupt):
            print('Quitting...')
        except Exception:
            traceback.print_exc()
            sys.exit(2)
        finally:
            if bc:
                bc.cleanup()


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<script language="JavaScript">
function ShowHide(divId) { 
    if(document.getElementById(divId).style.display == 'none') {
        document.getElementById(divId).style.display='block';
    } else { 
        document.getElementById(divId).style.display = 'none';
    } 
}
</script>
</body>
</html>
